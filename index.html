<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Diamond - Bot Master</title>
    <script src='//libtl.com/sdk.js' data-zone='10343752' data-sdk='show_10343752'></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap');
        body { background: radial-gradient(circle, #1e3a8a 0%, #0f172a 100%); color: white; font-family: 'Poppins', sans-serif; min-height: 100vh; padding-bottom: 90px; overflow-x: hidden; }
        .tab-content { display: none; width: 100%; max-width: 420px; margin: auto; padding: 15px; animation: fadeIn 0.4s; }
        .active-tab { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .glass-card { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .top-icons { position: fixed; top: 20px; right: 15px; z-index: 1000; }
        .float-btn { width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 2px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: iconSpin 12s linear infinite; cursor: pointer; background: linear-gradient(45deg, #fbbf24, #d97706); }
        @keyframes iconSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .level-row { display: grid; grid-template-columns: 1fr 2fr 2fr; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 11px; }
        .level-row.current { background: rgba(251, 191, 36, 0.2); border-radius: 8px; border: 1px solid #fbbf24; color: #fbbf24; font-weight: bold; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 23, 42, 0.95); display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid rgba(255,255,255,0.1); z-index: 500; }
        .nav-item { font-size: 10px; color: #94a3b8; text-align: center; flex: 1; cursor: pointer; }
        .nav-item.active { color: #fbbf24; font-weight: bold; }
        #ad-modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
    </style>
</head>
<body>

<div id="ad-modal">
    <div class="text-center">
        <div class="w-12 h-12 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
        <p class="text-yellow-500 font-bold uppercase text-[10px]">Processing...</p>
    </div>
</div>

<div class="top-icons" onclick="switchTab('spin-tab')"><div class="float-btn">ğŸ¡</div></div>

<div class="text-center mt-10">
    <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 italic tracking-tighter">ROYAL DIAMOND</h1>
</div>

<div id="home-tab" class="tab-content active-tab">
    <div class="glass-card text-center border-b-4 border-yellow-500">
        <p class="text-gray-400 text-[10px] uppercase tracking-widest">Your Balance</p>
        <p class="text-3xl font-black text-yellow-500">ğŸ’ <span id="home-balance">0</span></p>
        <p class="text-sm text-green-400 font-bold mt-1">ğŸ’° USDT: $<span id="usdt-balance">0.00</span></p>
    </div>
    
    <div class="glass-card">
        <div class="flex justify-between items-center mb-4">
            <span class="text-yellow-500 font-black text-xs italic">LVL <span id="display-level">1</span> BOT</span>
            <span id="bot-status" class="text-[9px] bg-red-600 px-2 py-0.5 rounded text-white font-bold tracking-tighter uppercase">Offline</span>
        </div>
        <div class="bg-black/40 p-5 rounded-xl mb-4 border border-white/5 text-center">
            <div class="flex justify-between text-[10px] mb-2 text-gray-400">
                <span>Timer: <span id="mine-timer">02:30:00</span></span>
                <span id="mine-percent">0%</span>
            </div>
            <div class="w-full bg-gray-700 h-2 rounded-full overflow-hidden">
                <div id="mine-progress-bar" class="bg-yellow-500 h-full w-0 transition-all duration-1000"></div>
            </div>
            <p class="text-center mt-3 text-2xl font-black text-green-400"><span id="auto-mined-val">0.00</span> ğŸ’</p>
        </div>
        <div class="grid grid-cols-2 gap-3 mb-4">
            <button id="btn-start" onclick="handleAction('start')" class="py-3 rounded-xl font-bold text-xs uppercase text-white bg-blue-600">Start</button>
            <button id="btn-claim" onclick="handleAction('claim')" class="py-3 rounded-xl font-bold text-xs uppercase text-white bg-green-600 opacity-50">Claim</button>
        </div>
        <button onclick="handleAction('upgrade')" class="w-full py-4 rounded-xl font-black text-[10px] uppercase flex justify-between px-6 shadow-xl bg-yellow-500 text-black">
            <span>Upgrade Bot</span><span id="upgrade-cost-text">100 ğŸ’</span>
        </button>
    </div>

    <div class="glass-card">
        <h3 class="text-yellow-500 font-black text-[10px] mb-4 uppercase">Bot Earning & Cost List</h3>
        <div id="level-list-container" style="max-height: 250px; overflow-y: auto;"></div>
    </div>
</div>

<div id="tasks-tab" class="tab-content">
    <h2 class="text-center py-4 font-black italic uppercase text-yellow-500">Available Tasks</h2>
    <div class="space-y-3">
        <div class="glass-card flex justify-between items-center border-l-4 border-yellow-500 p-4">
            <div><p class="text-[12px] font-bold">Watch New Video</p><p class="text-[10px] text-gray-400">Reward: 30,000 ğŸ’</p></div>
            <button id="task1" onclick="handleTask('https://youtube.com', 30000, 'task1')" class="bg-yellow-500 text-black px-4 py-2 rounded-lg text-[10px] font-black uppercase">Watch</button>
        </div>
        <div class="glass-card flex justify-between items-center border-l-4 border-red-600 p-4">
            <div><p class="text-[12px] font-bold">Subscribe YouTube</p><p class="text-[10px] text-gray-400">Reward: 50,000 ğŸ’</p></div>
            <button id="task2" onclick="handleTask('https://youtube.com', 50000, 'task2')" class="bg-red-600 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase">GO</button>
        </div>
        <div class="glass-card flex justify-between items-center border-l-4 border-blue-500 p-4">
            <div><p class="text-[12px] font-bold">Join Telegram</p><p class="text-[10px] text-gray-400">Reward: 40,000 ğŸ’</p></div>
            <button id="task3" onclick="handleTask('https://t.me/Referralincamebd01', 40000, 'task3')" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase">Join</button>
        </div>
    </div>
</div>

<div id="leader-tab" class="tab-content">
    <h2 class="text-center py-4 font-black italic uppercase text-yellow-500">Global Board</h2>
    <div id="leader-list" class="space-y-2"></div>
</div>

<div id="refer-tab" class="tab-content text-center">
    <div class="glass-card">
        <h2 class="text-yellow-500 font-black mb-4 uppercase italic">Invite Friends</h2>
        <p class="text-[11px] text-gray-300 mb-2">Every new referral gives you <span class="text-yellow-500 font-bold">10,000 ğŸ’</span></p>
        <p id="ref-link" class="text-[9px] mb-6 p-3 bg-black/40 rounded-lg text-gray-400 truncate italic">Loading...</p>
        <button onclick="copyRef()" class="bg-yellow-500 text-black px-12 py-3 rounded-xl font-black text-xs uppercase shadow-lg">Copy Link</button>
    </div>
</div>

<div id="wallet-tab" class="tab-content">
    <div class="glass-card text-center">
        <h2 class="text-yellow-500 font-black text-xl mb-6 uppercase italic">Withdraw</h2>
        <div class="bg-black/30 p-5 rounded-2xl border border-green-500/20 mb-6">
            <p class="text-xs text-green-400">USDT Balance: $ <span id="wallet-usdt-display">0.00</span></p>
            <input type="text" id="binance-uid" placeholder="Binance UID" class="w-full bg-black/50 border border-gray-700 p-3 rounded-xl text-xs mt-4 mb-2 text-white outline-none">
            <input type="number" id="withdraw-amount" placeholder="Min 20 USDT" class="w-full bg-black/50 border border-gray-700 p-3 rounded-xl text-xs mb-4 text-white outline-none">
            <button onclick="processWithdraw()" class="w-full bg-green-600 text-white font-black py-3 rounded-xl text-xs uppercase">Withdraw Now</button>
        </div>
    </div>
</div>

<div id="spin-tab" class="tab-content text-center">
    <div class="glass-card">
        <h2 class="text-yellow-500 font-black mb-4 uppercase italic">Lucky Wheel</h2>
        <div class="mb-4 bg-black/40 py-1 px-4 rounded-full inline-block border border-yellow-500/30">
            <p class="text-[10px] text-yellow-500 font-bold uppercase tracking-widest">Spin Cost: 100,000 ğŸ’</p>
        </div>
        <div style="position: relative; width: 280px; height: 280px; margin: auto;">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); z-index: 20; font-size: 30px; color: #ff0000;">â–¼</div>
            <canvas id="wheel-canvas" style="width: 100%; height: 100%; border-radius: 50%; border: 6px solid #fbbf24; transition: transform 6s cubic-bezier(0.1, 0, 0, 1);"></canvas>
        </div>
        <button onclick="handleAction('spin')" id="spin-btn" class="mt-8 bg-yellow-500 text-black font-black py-4 px-12 rounded-full uppercase shadow-xl leading-tight">
            SPIN NOW <br> <span class="text-[9px] font-bold opacity-70">- 100,000 ğŸ’</span>
        </button>
    </div>
</div>

<nav class="nav-bar">
    <div onclick="switchTab('home-tab', this)" class="nav-item active">ğŸ <br>Home</div>
    <div onclick="switchTab('tasks-tab', this)" class="nav-item">ğŸ“<br>Tasks</div>
    <div onclick="switchTab('leader-tab', this)" class="nav-item">ğŸ†<br>Board</div>
    <div onclick="switchTab('refer-tab', this)" class="nav-item">ğŸ‘¥<br>Refer</div>
    <div onclick="switchTab('wallet-tab', this)" class="nav-item">ğŸ’³<br>Wallet</div>
</nav>

<script>
// Firebase Setup
const firebaseConfig = { apiKey: "AIzaSyA-2VRyhIktuhWesvHRa2LkqAL3g_fDU0", authDomain: "royaldiamondbot.firebaseapp.com", databaseURL: "https://royaldiamondbot-default-rtdb.firebaseio.com", projectId: "royaldiamondbot", storageBucket: "royaldiamondbot.firebasestorage.app", messagingSenderId: "156914195366", appId: "1:156914195366:web:e5ab56df62ecbf90550d67" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userId = localStorage.getItem('user_uid') || "User_" + Math.floor(Math.random() * 89999 + 10000);
localStorage.setItem('user_uid', userId);
const referralLink = "https://t.me/Referralincamebd01311_bot?start=" + userId;

let bal = 0, usdtBal = 0, botLevel = 1, autoMineStart = 0;

// Refer Check on Login
const urlParams = new URLSearchParams(window.location.search);
const referrerId = urlParams.get('start');

db.ref('users/' + userId).once('value', snap => {
    if (!snap.exists()) {
        db.ref('users/' + userId).set({ balance: 0, usdtBalance: 0, botLevel: 1, autoMineStart: 0 });
        if (referrerId && referrerId !== userId) {
            db.ref('users/' + referrerId + '/balance').transaction(b => (b || 0) + 10000);
        }
    }
});

// Sync Real-time Data
db.ref('users/' + userId).on('value', snap => {
    const data = snap.val() || {};
    bal = Number(data.balance) || 0;
    usdtBal = Number(data.usdtBalance) || 0;
    botLevel = Number(data.botLevel) || 1; 
    autoMineStart = Number(data.autoMineStart) || 0;
    document.getElementById('home-balance').innerText = Math.floor(bal).toLocaleString();
    document.getElementById('usdt-balance').innerText = usdtBal.toFixed(2);
    document.getElementById('wallet-usdt-display').innerText = usdtBal.toFixed(2);
    document.getElementById('display-level').innerText = botLevel;
    document.getElementById('upgrade-cost-text').innerText = (100 * Math.pow(2, botLevel - 1)).toLocaleString() + " ğŸ’";
    document.getElementById('ref-link').innerText = referralLink;
    generateLevelChart(botLevel);
    checkCompletedTasks();
});

function handleAction(type) {
    if(type === 'spin' && bal < 100000) { alert("Not enough diamonds!"); return; }
    if(typeof show_10343752 === 'function') show_10343752();
    document.getElementById('ad-modal').style.display = 'flex';
    setTimeout(() => {
        document.getElementById('ad-modal').style.display = 'none';
        if(type === 'start') db.ref('users/' + userId).update({ autoMineStart: Math.floor(Date.now() / 1000) });
        if(type === 'claim') db.ref('users/' + userId).update({ balance: bal + (botLevel * 2000), autoMineStart: 0 });
        if(type === 'upgrade') {
            let cost = 100 * Math.pow(2, botLevel - 1);
            if(bal >= cost) db.ref('users/' + userId).update({ balance: bal - cost, botLevel: botLevel + 1 });
            else alert("Need more diamonds!");
        }
        if(type === 'spin') startSpin();
    }, 2000);
}

// à¦“à§Ÿà¦¾à¦¨-à¦Ÿà¦¾à¦‡à¦® à¦¸à¦¿à¦•à¦¿à¦‰à¦° à¦Ÿà¦¾à¦¸à§à¦• à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®
function handleTask(url, reward, taskId) {
    db.ref('users/' + userId + '/completedTasks/' + taskId).once('value', snap => {
        if (snap.exists()) {
            alert("Already completed!");
        } else {
            if(typeof show_10343752 === 'function') show_10343752();
            window.open(url, '_blank');
            document.getElementById('ad-modal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('ad-modal').style.display = 'none';
                db.ref('users/' + userId).update({ balance: bal + reward });
                db.ref('users/' + userId + '/completedTasks/' + taskId).set(true);
            }, 5000);
        }
    });
}

function checkCompletedTasks() {
    db.ref('users/' + userId + '/completedTasks').once('value', snap => {
        if (snap.exists()) {
            let done = snap.val();
            for (let id in done) {
                let btn = document.getElementById(id);
                if (btn) {
                    btn.disabled = true; btn.innerText = "DONE"; btn.style.opacity = "0.5";
                    btn.classList.add('bg-gray-600');
                }
            }
        }
    });
}

function generateLevelChart(current) {
    let html = '';
    for(let i=1; i<=25; i++) {
        let income = i * 2000, cost = 100 * Math.pow(2, i-1);
        let active = (i === current) ? 'current' : '';
        html += `<div class="level-row ${active}"><span>LVL ${i}</span><span>${income} ğŸ’</span><span>${(i === 25 ? 'MAX' : cost.toLocaleString())}</span></div>`;
    }
    document.getElementById('level-list-container').innerHTML = html;
}

function updateLeaderboard() {
    db.ref('users').once('value', snap => {
        let arr = [];
        snap.forEach(u => { arr.push({id: u.key, balance: Number(u.val().balance || 0)}); });
        arr.sort((a, b) => b.balance - a.balance);
        let html = arr.slice(0, 10).map((u, i) => {
            let rank = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : `#${i+1}`;
            return `<div class="flex justify-between p-3 bg-white/5 rounded-xl border border-white/10 mb-2">
                <span class="text-yellow-500 font-bold w-8">${rank}</span>
                <span class="text-[10px] flex-1">${u.id.substring(0,12)}...</span>
                <span class="text-yellow-500 font-black">ğŸ’ ${Math.floor(u.balance).toLocaleString()}</span>
            </div>`
        }).join('');
        document.getElementById('leader-list').innerHTML = html;
    });
}

function switchTab(id, el) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active-tab');
    if(el) el.classList.add('active');
    if(id === 'leader-tab') updateLeaderboard();
}

// --- à¦¸à¦¿à¦¨à§à¦¦à§à¦• à¦ªà¦¾à¦¹à¦¾à¦°à¦¾ à¦¸à§à¦ªà¦¿à¦¨ à¦²à¦œà¦¿à¦• ---
const canvas = document.getElementById('wheel-canvas'); const ctx = canvas.getContext('2d');
canvas.width = 300; canvas.height = 300;

const prizes = [
    "10 USDT", "20k ğŸ’", "0.10 USDT", "30k ğŸ’", "0.05 USDT", 
    "40k ğŸ’", "0.20 USDT", "50k ğŸ’", "0.15 USDT", "60k ğŸ’", 
    "0.30 USDT", "70k ğŸ’", "0.01 USDT", "80k ğŸ’", "0.25 USDT", 
    "90k ğŸ’", "0.50 USDT", "100k ğŸ’"
];

function drawWheel() {
    const arc = (2 * Math.PI) / 18;
    for (let i = 0; i < 18; i++) {
        ctx.fillStyle = (i % 2 === 0) ? "#fbbf24" : "#3b82f6";
        ctx.beginPath(); ctx.moveTo(150, 150); ctx.arc(150, 150, 150, i * arc, (i + 1) * arc); ctx.fill();
        ctx.save(); ctx.fillStyle = "black"; ctx.font = "bold 9px Arial";
        ctx.translate(150 + Math.cos(i * arc + arc/2) * 110, 150 + Math.sin(i * arc + arc/2) * 110);
        ctx.rotate(i * arc + arc/2 + Math.PI/2);
        let text = prizes[i].split(" ")[0];
        ctx.fillText(text, -ctx.measureText(text).width/2, 0); ctx.restore();
    }
} drawWheel();

let currentRotation = 0;
function startSpin() {
    db.ref('users/' + userId).update({ balance: bal - 100000 });

    // à§§à§¦.à§« USDT (index 0) à¦•à¦–à¦¨à§‹à¦‡ à¦ªà§œà¦¬à§‡ à¦¨à¦¾
    let safeIdx;
    do { safeIdx = Math.floor(Math.random() * 18); } while (safeIdx === 0);

    let extraRot = (18 - safeIdx) * (360 / 18);
    currentRotation += 3600 + extraRot;
    canvas.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(() => {
        let won = prizes[safeIdx];
        if (won.includes("ğŸ’")) {
            let val = parseInt(won) * 1000;
            db.ref('users/' + userId).update({ balance: (bal - 100000) + val });
        } else {
            let val = parseFloat(won);
            db.ref('users/' + userId).update({ usdtBalance: usdtBal + val });
        }
        alert(`You Won: ${won}`);
    }, 6100);
}

function processWithdraw() {
    let uid = document.getElementById('binance-uid').value;
    let amt = parseFloat(document.getElementById('withdraw-amount').value);
    if(uid && amt >= 20 && amt <= usdtBal) {
        db.ref('withdrawals').push({ userId, uid, amt, status: 'pending', time: Date.now() });
        db.ref('users/' + userId).update({ usdtBalance: usdtBal - amt });
        alert("Request Sent!");
    } else alert("Min 20 USDT & Valid UID!");
}

setInterval(() => {
    let sBtn = document.getElementById('btn-start'), cBtn = document.getElementById('btn-claim');
    if (autoMineStart === 0) {
        sBtn.disabled = false; cBtn.disabled = true; cBtn.style.opacity = "0.5"; sBtn.style.opacity = "1";
        document.getElementById('bot-status').innerText = "Offline"; return;
    }
    let elap = Math.floor(Date.now() / 1000) - autoMineStart, dur = 9000;
    if (elap < dur) {
        sBtn.disabled = true; cBtn.disabled = true; sBtn.style.opacity = "0.5";
        let left = dur - elap;
        document.getElementById('mine-timer').innerText = new Date(left * 1000).toISOString().substr(11, 8);
        document.getElementById('mine-progress-bar').style.width = (elap/dur*100) + "%";
        document.getElementById('mine-percent').innerText = Math.floor(elap/dur*100) + "%";
        document.getElementById('auto-mined-val').innerText = ((elap/dur)*(botLevel*2000)).toFixed(2);
        document.getElementById('bot-status').innerText = "Mining";
    } else {
        cBtn.disabled = false; cBtn.style.opacity = "1";
        document.getElementById('bot-status').innerText = "Ready";
    }
}, 1000);

function copyRef() { navigator.clipboard.writeText(referralLink); alert("Copied!"); }
</script>
</body>
    </html>
                
